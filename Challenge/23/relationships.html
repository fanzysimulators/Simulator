<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="../../favicon.png">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Challenge: Battle of the Sexes 2 — Relationships</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="./style.css" />

<style>
  #rel-grid{
    display:grid; gap:16px;
    grid-template-columns:repeat(4,minmax(240px,1fr));
  }
  @media (max-width:1200px){#rel-grid{grid-template-columns:repeat(3,minmax(240px,1fr));}}
  @media (max-width:900px){#rel-grid{grid-template-columns:repeat(2,minmax(240px,1fr));}}
  @media (max-width:560px){#rel-grid{grid-template-columns:1fr;}}

  .rel-card.mini-card{padding:14px; gap:10px; max-width:360px; margin-inline:auto;}
  .rel-card .avatar{width:96px;height:96px;}
  .rel-card .name{font-weight:600;}

.neo-select {
  position:relative;
  width:100%;
  border-radius:12px;
  padding:1px;
  background:rgba(255,255,255,0.1);
  box-shadow:0 0 0 1px rgba(255,255,255,0.12) inset;
}

.neo-select select {
  appearance:none;
  width:100%;
  border:none;
  outline:none;
  padding:12px 40px 12px 14px;
  border-radius:10px;
  font-weight:600;
  background:#0d0d0d;
  color:white;
}

.neo-select::after {
  content:"";
  position:absolute;
  right:12px;
  top:50%;
  width:14px;
  height:14px;
  transform:translateY(-50%);
  background-image:url('data:image/svg+xml;utf8,<svg width="14" height="14" viewBox="0 0 24 24" fill="%23ffffff" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5"/></svg>');
  opacity:.9;
}

  .focus-avatar-wrap { display: grid; justify-items: center; gap: 8px; margin-bottom: 8px; }
  .focus-name { font-weight: 600; }
</style>
</head>
<body>
  <div class="bg fx-nebula" aria-hidden="true"></div>
  <div class="bg fx-hex" aria-hidden="true"></div>
  <div class="bg fx-circuit" aria-hidden="true"></div>
  <div class="bg fx-glow" aria-hidden="true"></div>

  <header class="site-header">
    <div class="brand">
      <span class="logo-dot" aria-hidden="true"></span>
      <h1>Battle of the Sexes 2 - Relationships</h1>
    </div>
    <nav class="top-nav" aria-label="Primary">
      <a class="btn nav" href="../../index.html">Home</a>
      <button class="btn" id="btn-reset-session" type="button">Reset Season</button>
    </nav>
  </header>

  <div class="page-shell antm-shell">
    <aside class="sidebar left">
      <div class="panel">
        <h3>Relationships</h3>

        <div class="focus-avatar-wrap">
          <img id="focus-avatar" class="avatar ring" src="./BlankProfile.webp" alt="">
          <div id="focus-name" class="focus-name">Contestant</div>
        </div>
        <div class="filter" style="justify-content:center; margin-bottom:10px;">
          <select id="focus" aria-label="Choose focal contestant"></select>
        </div>

        <div class="stack" style="justify-content:center; margin-bottom:10px;">
          <button class="btn" id="prev" type="button">◀ Prev</button>
          <button class="btn" id="next" type="button">Next ▶</button>
        </div>

        <div class="sep"></div>

        <div class="stack" style="justify-content:center;">
          <button class="btn" id="rand-player" type="button">Randomize Player</button>
          <button class="btn" id="rand-all" type="button">Randomize Cast</button>
          <button class="btn" id="reset-player" type="button">Reset Player</button>
          <button class="btn" id="reset-all" type="button">Reset Cast</button>
        </div>

        <div class="sep"></div>
        <div class="stack" style="justify-content:center;">
          <a class="btn" href="./index.html">Back to Simulator</a>
        </div>
      </div>
    </aside>

    <main class="content">
      <section class="block">
        <header class="block-head center">
          <h2>Set Relationships</h2>
          <p class="muted">Choose a contestant on the left, then set how they feel about each of the others. Saved for this session.</p>
        </header>

        <div id="no-cast" class="center-text" hidden>
          <p class="muted">No cast found for this session. Go back and choose your cast first.</p>
          <div class="stack" style="justify-content:center;">
            <a class="btn" href="./index.html">Back</a>
          </div>
        </div>

        <div id="rel-grid"></div>
      </section>
    </main>

    <aside class="sidebar right">
      <div class="panel">
        <h3>Scale</h3>
        <ul class="bullet-list">
          <li><strong>5</strong> — Best Friend</li>
          <li><strong>4</strong> — Bonded</li>
          <li><strong>3</strong> — Close Friends</li>
          <li><strong>2</strong> — Friends</li>
          <li><strong>1</strong> — Acquaintances (Warm)</li>
          <li><strong>0</strong> — Neutral</li>
          <li><strong>-1</strong> — Acquaintances (Cold)</li>
          <li><strong>-2</strong> — Uneasy</li>
          <li><strong>-3</strong> — Dislike</li>
          <li><strong>-4</strong> — Rival</li>
          <li><strong>-5</strong> — Nemesis</li>
        </ul>
      </div>
    </aside>
  </div>

  <script>
  (function(){
    "use strict";

    var KEY = "challenge-bots-season";
    var State={ load:function(){try{ return JSON.parse(sessionStorage.getItem(KEY))||null }catch(e){return null}},
                save:function(s){ sessionStorage.setItem(KEY, JSON.stringify(s)); },
                clear:function(){ sessionStorage.removeItem(KEY);} };
    var $ = function(s){ return document.querySelector(s); };

    $("#btn-reset-session").onclick = function(){ State.clear(); location.href="./index.html"; };

    var state = State.load();

function mergedCast(){
  if (!state || !state.teams) return [];

  var result = [];
  var teams = state.teams || {};

  Object.keys(teams).forEach(function(teamKey){
    var team = teams[teamKey] || {};

    ["women", "men"].forEach(function(group){
      (team[group] || []).forEach(function(p){
        if (p) result.push(p);
      });
    });
  });

  return result;
}
    function castIds(){ return mergedCast().map(function(c){return c.id;}); }
    function find(id){ return mergedCast().find(function(c){return c.id===id;}); }
    function nameOf(id){ var p=find(id); return p ? (p.nickname || p.name || id) : id; }
    function imgOf(id){ var p=find(id); return (p && p.image) || "./BlankProfile.webp"; }

    if(!state || !mergedCast().length){
      $("#no-cast").hidden=false; return;
    }

    if(!state.relationships) state.relationships = {};

    function k(a,b){ return (a<b) ? (a+"|"+b) : (b+"|"+a); }
    function getRel(a,b){ if(a===b) return 0; return Number(state.relationships[k(a,b)] || 0); }
    function setRel(a,b,val){ if(a===b) return; state.relationships[k(a,b)] = Number(val); }
    var ids = castIds();
    $("#focus").innerHTML = ids.map(function(id){ return '<option value="'+id+'">'+nameOf(id)+'</option>'; }).join("");
    $("#focus").onchange = function(){ updateFocus(); renderGrid(); };

    $("#prev").onclick=function(){
      var cur=$("#focus").value; var i=ids.indexOf(cur);
      $("#focus").value = ids[(i<=0?ids.length-1:i-1)];
      updateFocus(); renderGrid();
    };
    $("#next").onclick=function(){
      var cur=$("#focus").value; var i=ids.indexOf(cur);
      $("#focus").value = ids[(i>=ids.length-1?0:i+1)];
      updateFocus(); renderGrid();
    };

    function updateFocus(){
      var id=$("#focus").value;
      $("#focus-avatar").src = imgOf(id);
      $("#focus-name").textContent = nameOf(id);
    }

    var REL_VALUES=[5,4,3,2,1,0,-1,-2,-3,-4,-5];
    var REL_LABELS={5:"Best Friend",4:"Bonded",3:"Close Friends",2:"Friends",1:"Acquaintances (Warm)",0:"Neutral","-1":"Acquaintances (Cold)","-2":"Uneasy","-3":"Dislike","-4":"Rival","-5":"Nemesis"};

    function renderGrid(){
      var grid=$("#rel-grid"); grid.innerHTML="";
      var focus=$("#focus").value;
      var others = ids.filter(function(id){return id!==focus;}).sort(function(a,b){ return nameOf(a).localeCompare(nameOf(b)); });
      for(var i=0;i<others.length;i++){
        var oid=others[i];
        var card=document.createElement("div"); card.className="mini-card rel-card";
        card.innerHTML =
          '<img class="avatar ring" src="'+imgOf(oid)+'" alt="">'+
          '<div class="name"><strong>'+nameOf(oid)+'</strong></div>'+
          '<div class="neo-select"><select data-target="'+oid+'">'+
            REL_VALUES.map(function(v){ return '<option value="'+v+'">'+v+': '+REL_LABELS[v]+'</option>'; }).join("")+
          '</select></div>';
        var sel = card.querySelector("select");
        sel.value = String(getRel(focus, oid));
        sel.onchange = function(e){
          var other = e.target.getAttribute("data-target");
          setRel(focus, other, Number(e.target.value));
          State.save(state);
        };
        grid.appendChild(card);
      }
    }

    function rndRel(){ return REL_VALUES[Math.floor(Math.random()*REL_VALUES.length)]; }

    $("#rand-player").onclick=function(){
      var focus=$("#focus").value;
      ids.forEach(function(oid){ if(oid!==focus) setRel(focus, oid, rndRel()); });
      State.save(state); renderGrid();
    };
    $("#rand-all").onclick=function(){
      for(var i=0;i<ids.length;i++){
        for(var j=i+1;j<ids.length;j++){
          setRel(ids[i], ids[j], rndRel());
        }
      }
      State.save(state); renderGrid();
    };
    $("#reset-player").onclick=function(){
      var focus=$("#focus").value;
      ids.forEach(function(oid){ if(oid!==focus) setRel(focus, oid, 0); });
      State.save(state); renderGrid();
    };
    $("#reset-all").onclick=function(){
      state.relationships = {};
      State.save(state); renderGrid();
    };

    updateFocus(); renderGrid();
  })();
  </script>
</body>
</html>
