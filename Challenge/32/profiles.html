<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="../../favicon.png">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Profiles — The Challenge: Final Reckoning</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="./style.css" />

<style>
  .skills-grid { display: grid; gap: 16px; grid-template-columns: repeat(2, minmax(240px, 1fr)); }
  @media (max-width: 900px){ .skills-grid { grid-template-columns: 1fr; } }

  .skill-card {
    display: grid; gap: 8px; padding: 12px; border-radius: 14px;
    border: 1px solid rgba(255,255,255,.12);
    background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04)), rgba(255,255,255,.06);
    backdrop-filter: blur(8px);
  }
  .skill-title { font-weight: 600; letter-spacing: .2px; }
  .skill-desc  { font-size: .82rem; color: var(--muted); line-height: 1.25; }

  .neo-select{
    --glow: rgba(106,169,255,.28);
    position:relative; width:100%; border-radius:12px; padding:1px;
    background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.08));
    box-shadow: 0 0 0 1px rgba(255,255,255,.10) inset, 0 0 18px var(--glow);
    transition: box-shadow .25s ease, transform .2s ease; backdrop-filter: blur(var(--panel-blur));
  }
  .neo-select:focus-within{ box-shadow: 0 0 0 1px rgba(255,255,255,.12) inset, 0 0 26px var(--glow); transform: translateY(-1px); }
  .neo-select select{
    appearance:none; -webkit-appearance:none; width:100%;
    border:none; outline:none; border-radius:10px;
    padding:12px 44px 12px 14px;
    font-weight:600; color:var(--text);
    background: rgba(255,255,255,.06);
    transition: background-color .25s ease, color .25s ease, box-shadow .2s ease;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.35), inset 0 -1px 0 rgba(0,0,0,.12);
  }
  .neo-select::after{
    content:""; position:absolute; right:12px; top:50%; width:14px; height:14px; pointer-events:none; transform: translateY(-50%);
    background-image: url('data:image/svg+xml;utf8,<svg width="14" height="14" viewBox="0 0 24 24" fill="%23ffffff" xmlns="http://www.w3.org/2000/svg"><path opacity="0.9" d="M7 10l5 5 5-5"/></svg>');
    filter: drop-shadow(0 1px 2px rgba(0,0,0,.35)); opacity:.9;
  }

  .focus-avatar-wrap { display: grid; justify-items: center; gap: 8px; margin-bottom: 8px; }
  .focus-name { font-weight: 600; }

.neo-select select{
  appearance:none; -webkit-appearance:none; width:100%;
  border:none; outline:none; border-radius:10px;
  padding:12px 44px 12px 14px;
  font-weight:600;

  background-color:#0d0d0d !important;
  color:#fff !important;
  color-scheme: dark;

  box-shadow: inset 0 1px 0 rgba(255,255,255,.12), inset 0 -1px 0 rgba(0,0,0,.35);
}

.filter select {
  background: #0d0d0d;
  color: #ffffff;
}

.filter select option {
  background: #0d0d0d;
  color: #ffffff;
}
</style>
</head>
<body>
  <div class="bg fx-nebula" aria-hidden="true"></div>
  <div class="bg fx-hex" aria-hidden="true"></div>
  <div class="bg fx-circuit" aria-hidden="true"></div>
  <div class="bg fx-glow" aria-hidden="true"></div>

  <header class="site-header">
    <div class="brand">
      <span class="logo-dot" aria-hidden="true"></span>
      <h1>The Challenge: Final Reckoning</h1>
    </div>
    <nav class="top-nav" aria-label="Primary">
      <a class="btn nav" href="../../index.html">Home</a>
      <button class="btn" id="btn-reset-session" type="button">Reset Season</button>
    </nav>
  </header>

  <div class="page-shell antm-shell">
    <aside class="sidebar left">
      <div class="panel">
        <h3>Profiles</h3>

        <div class="focus-avatar-wrap">
          <img id="focus-avatar" class="avatar ring" src="./BlankProfile.webp" alt="">
          <div id="focus-name" class="focus-name">Contestant</div>
        </div>
        <div class="filter" style="justify-content:center; margin-bottom:10px;">
          <select id="focus" aria-label="Choose focal contestant"></select>
        </div>

        <div class="stack" style="justify-content:center; margin-bottom:10px;">
          <button class="btn" id="prev" type="button">◀ Prev</button>
          <button class="btn" id="next" type="button">Next ▶</button>
        </div>

        <div class="sep"></div>

        <div class="stack" style="justify-content:center;">
          <button class="btn" id="rand-player" type="button">Randomize Player</button>
          <button class="btn" id="rand-all" type="button">Randomize Cast</button>
          <button class="btn" id="reset-player" type="button">Reset Player</button>
          <button class="btn" id="reset-all" type="button">Reset Cast</button>
        </div>

        <div class="sep"></div>
        <div class="stack" style="justify-content:center;">
          <a class="btn" href="./index.html">Back to Simulator</a>
        </div>
      </div>
    </aside>

    <main class="content">
      <section class="block">
        <header class="block-head center">
          <h2>Profiles</h2>
          <p class="muted">Set skill tiers for each contestant. Values are saved for this session.</p>
        </header>

        <div id="no-cast" class="center-text" hidden>
          <p class="muted">No cast found for this session. Go back and choose your cast first.</p>
          <div class="stack" style="justify-content:center;">
            <a class="btn" href="./index.html">Back</a>
          </div>
        </div>

        <!-- Competition skills -->
        <div class="block-head center"><h3>Competition Skills</h3></div>
        <div id="skills-wrap" class="skills-grid"></div>

        <!-- Social skills -->
        <div class="block-head center" style="margin-top:18px;"><h3>Social Skills</h3></div>
        <div id="social-wrap" class="skills-grid"></div>
      </section>
    </main>

    <aside class="sidebar right">
      <div class="panel">
        <h3>Tier Scale</h3>
        <ul class="bullet-list">
          <li><strong>+3</strong> — Great</li>
          <li><strong>+2</strong> — Really Good</li>
          <li><strong>+1</strong> — Good</li>
          <li><strong>0</strong> — Okay</li>
          <li><strong>-1</strong> — Passable</li>
          <li><strong>-2</strong> — Weak</li>
          <li><strong>-3</strong> — Bad</li>
        </ul>
      </div>
    </aside>
  </div>

  <script src="../../player_data.js"></script>
  <script>
  (function(){
    "use strict";

    const KEY="challenge-fr-season";
    const State={load(){try{return JSON.parse(sessionStorage.getItem(KEY))||null}catch{return null}},
                 save(s){sessionStorage.setItem(KEY,JSON.stringify(s))},
                 clear(){sessionStorage.removeItem(KEY)}};
    const $=s=>document.querySelector(s);
    $("#btn-reset-session").onclick=()=>{State.clear();location.href="./index.html";};

    let state=State.load();
    if(!state || !Array.isArray(state.teams)){
      document.getElementById("no-cast").hidden=false;
      state = state || { profiles:{}, cast:[] };
    }
    state.profiles = state.profiles || {};

    function merge(dst,src){ if(!src) return; for(const k in src){ if(src[k] && !dst[k]) dst[k]=src[k]; } }
    function mapFromPlayerData(){
      const pd = window.playerData || {}; const m={};
      ["males","females","others"].forEach(b=>{
        (pd[b]||[]).forEach(p=>{ if(p&&p.id&&!m[p.id]) m[p.id]=Object.assign({},p); });
      });
      return m;
    }
    function mapFromState(st){
      const m={};
      if(Array.isArray(st.cast)){ st.cast.forEach(p=>{ if(p&&p.id&&!m[p.id]) m[p.id]=Object.assign({},p); }); }
      if(st.PLAYERS_BY_ID) merge(m, st.PLAYERS_BY_ID);
      if(Array.isArray(st.players)){ st.players.forEach(p=>{ if(p&&p.id&&!m[p.id]) m[p.id]=Object.assign({},p); }); }
      return m;
    }
    function mapFromOpener(){
      try{ if(window.opener && window.opener.PLAYERS_BY_ID) return window.opener.PLAYERS_BY_ID; }catch(_){}
      try{ if(window.parent && window.parent!==window && window.parent.PLAYERS_BY_ID) return window.parent.PLAYERS_BY_ID; }catch(_){}
      return null;
    }

    const BYID=(function(){
      const a = mapFromPlayerData();
      const b = mapFromState(state);
      const c = (typeof window.PLAYERS_BY_ID==="object") ? window.PLAYERS_BY_ID : null;
      const d = mapFromOpener();
      const out={}; merge(out,a); merge(out,b); merge(out,c); merge(out,d);
      for(const id in out){
        const p=out[id];
        p.nickname = p.nickname || p.name || id;
        p.image = p.image || ("./contestant_pictures/"+id+".webp");
      }
      return out;
    })();

    function nameOf(id){ const p=BYID[id]; return p ? (p.nickname||p.name||id) : id; }
    function imgOf(id){ const p=BYID[id]; return (p && p.image) ? p.image : "./BlankProfile.webp"; }

    function aliveCastIds(){
      const ids=[];
      (state.teams||[]).forEach(t=>{
        if(!t) return;
        if(t.aId) ids.push(t.aId);
        if(t.bId) ids.push(t.bId);
      });
      return Array.from(new Set(ids));
    }
    const COMP_SKILLS = [
      ["balance","Balance","Core control, steadiness on beams, ledges, and unstable surfaces."],
      ["climbing","Climbing","Upper-body strength, grip, and footwork for walls, ropes, and ladders."],
      ["eating","Eating","Speed and tolerance in eating challenges; mind-over-matter."],
      ["endurance","Endurance","Sustained output over long distances or time; stamina."],
      ["mental","Mental","Puzzles, memory, pattern reading, and pressure decision-making."],
      ["speed","Speed","Short burst pace, sprints, and quick transitions."],
      ["strength","Strength","Raw power in lifts, carries, drags, and contact tasks."],
      ["swimming","Swimming","Technique in water, breath control, and transitions in/out."],
      ["teamwork","Team Work","Communication, coordination, and synergy with a partner."]
    ];
    const SOCIAL_SKILLS = [
      ["strategy","Strategy","Reads the house, plays votes, and positions themselves advantageously."],
      ["temperament","Temperament","Emotional control and composure under stress and conflict."],
      ["loyalty","Loyalty","Reliability as an ally vs. opportunism; perceived trustworthiness."]
    ];
    const TIERS=[3,2,1,0,-1,-2,-3];
    const TIER_LABELS={3:"+3 Great",2:"+2 Really Good",1:"+1 Good",0:"0 Okay","-1":"-1 Passable","-2":"-2 Weak","-3":"-3 Bad"};

    function ensureProfiles(pid){
      if(!state.profiles[pid]) state.profiles[pid] = {};
      [...COMP_SKILLS.map(s=>s[0]),...SOCIAL_SKILLS.map(s=>s[0])].forEach(k=>{
        if(typeof state.profiles[pid][k] !== "number") state.profiles[pid][k]=0;
      });
    }

    function buildFocus(ids){
      const sel=$("#focus");
      sel.innerHTML = ids.map(id=>`<option value="${id}">${nameOf(id)}</option>`).join("");
      sel.onchange=()=>{ updateFocus(); renderSkills(); renderSocial(); };
    }
    function updateFocus(){
      const id=$("#focus").value;
      $("#focus-avatar").src=imgOf(id);
      $("#focus-name").textContent=nameOf(id);
    }

    function optionHTML(){ return TIERS.map(v=>`<option value="${v}">${TIER_LABELS[String(v)]}</option>`).join(""); }
    function skillCardHTML(key,title,desc){
      return `
        <div class="skill-card">
          <div class="skill-title">${title}</div>
          <div class="skill-desc">${desc}</div>
          <div class="neo-select">
            <select data-skill="${key}">
              ${optionHTML()}
            </select>
          </div>
        </div>
      `;
    }

    function renderSkills(){
      const id=$("#focus").value; if(!id) return;
      ensureProfiles(id);
      const wrap=$("#skills-wrap"); wrap.innerHTML="";
      for(const [key,title,desc] of COMP_SKILLS){
        const holder=document.createElement("div");
        holder.innerHTML=skillCardHTML(key,title,desc);
        const card=holder.firstElementChild;
        const sel=card.querySelector("select");
        sel.value=String(state.profiles[id][key]);
        sel.addEventListener("change",()=>{ state.profiles[id][key]=Number(sel.value); State.save(state); });
        wrap.appendChild(card);
      }
    }

    function renderSocial(){
      const id=$("#focus").value; if(!id) return;
      ensureProfiles(id);
      const wrap=$("#social-wrap"); wrap.innerHTML="";
      for(const [key,title,desc] of SOCIAL_SKILLS){
        const holder=document.createElement("div");
        holder.innerHTML=skillCardHTML(key,title,desc);
        const card=holder.firstElementChild;
        const sel=card.querySelector("select");
        sel.value=String(state.profiles[id][key]);
        sel.addEventListener("change",()=>{ state.profiles[id][key]=Number(sel.value); State.save(state); });
        wrap.appendChild(card);
      }
    }

    function allIds(){ return aliveCastIds().sort((a,b)=>nameOf(a).localeCompare(nameOf(b))); }

    function wireSide(ids){
      document.getElementById("prev").onclick=()=>{
        const cur=$("#focus").value; const i=ids.indexOf(cur);
        $("#focus").value = ids[(i<=0?ids.length-1:i-1)];
        updateFocus(); renderSkills(); renderSocial();
      };
      document.getElementById("next").onclick=()=>{
        const cur=$("#focus").value; const i=ids.indexOf(cur);
        $("#focus").value = ids[(i>=ids.length-1?0:i+1)];
        updateFocus(); renderSkills(); renderSocial();
      };
      document.getElementById("rand-player").onclick=()=>{
        const id=$("#focus").value; ensureProfiles(id);
        [...COMP_SKILLS.map(s=>s[0]),...SOCIAL_SKILLS.map(s=>s[0])].forEach(k=>{
          state.profiles[id][k] = [3,2,1,0,-1,-2,-3][Math.floor(Math.random()*7)];
        });
        State.save(state); renderSkills(); renderSocial();
      };
      document.getElementById("rand-all").onclick=()=>{
        ids.forEach(id=>{
          ensureProfiles(id);
          [...COMP_SKILLS.map(s=>s[0]),...SOCIAL_SKILLS.map(s=>s[0])].forEach(k=>{
            state.profiles[id][k] = [3,2,1,0,-1,-2,-3][Math.floor(Math.random()*7)];
          });
        });
        State.save(state); renderSkills(); renderSocial();
      };
      document.getElementById("reset-player").onclick=()=>{
        const id=$("#focus").value; ensureProfiles(id);
        [...COMP_SKILLS.map(s=>s[0]),...SOCIAL_SKILLS.map(s=>s[0])].forEach(k=>{ state.profiles[id][k]=0; });
        State.save(state); renderSkills(); renderSocial();
      };
      document.getElementById("reset-all").onclick=()=>{
        ids.forEach(id=>{ state.profiles[id]={}; });
        State.save(state); renderSkills(); renderSocial();
      };
    }

    const ids = allIds();
    if(!ids.length){ document.getElementById("no-cast").hidden=false; }
    buildFocus(ids);
    if(ids.length){ $("#focus").value=ids[0]; updateFocus(); renderSkills(); renderSocial(); }
    wireSide(ids);

  })();
  </script>
</body>
</html>
