<?php
// save_cast.php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $castData = [
        'male_teams' => [],
        'female_teams' => []
    ];
    
    // Process male teams (1-7)
    for ($i = 1; $i <= 7; $i++) {
        $team = [];
        
        // Player 1
        if (!empty($_POST["male_{$i}_1_custom_name"])) {
            $team[] = [
                'name' => $_POST["male_{$i}_1_custom_name"],
                'image' => $_POST["male_{$i}_1_custom_image"] ?? 'https://via.placeholder.com/100?text=Custom'
            ];
        } elseif (!empty($_POST["male_{$i}_1"])) {
            // Get player data from database/JSON based on ID
            $playerId = $_POST["male_{$i}_1"];
            $playerData = getPlayerById($playerId); // You'll need to implement this
            if ($playerData) {
                $team[] = $playerData;
            }
        }
        
        // Player 2
        if (!empty($_POST["male_{$i}_2_custom_name"])) {
            $team[] = [
                'name' => $_POST["male_{$i}_2_custom_name"],
                'image' => $_POST["male_{$i}_2_custom_image"] ?? 'https://via.placeholder.com/100?text=Custom'
            ];
        } elseif (!empty($_POST["male_{$i}_2"])) {
            $playerId = $_POST["male_{$i}_2"];
            $playerData = getPlayerById($playerId);
            if ($playerData) {
                $team[] = $playerData;
            }
        }
        
        if (!empty($team)) {
            $castData['male_teams'][] = ['members' => $team];
        }
    }
    
    // Process female teams (1-7) - similar logic
    
    // Save to session or database
    session_start();
    $_SESSION['rivals_cast'] = $castData;
    
    // Redirect back to season page
    header('Location: rivals.html');
    exit;
}

function getPlayerById($id) {
    // Load players.json and find player by ID
    $playersData = json_decode(file_get_contents('data/players.json'), true);
    
    // Search in male_players
    foreach ($playersData['male_players'] as $player) {
        if ($player['id'] == $id) {
            return [
                'name' => $player['name'],
                'image' => $player['image']
            ];
        }
    }
    
    // Search in female_players
    foreach ($playersData['female_players'] as $player) {
        if ($player['id'] == $id) {
            return [
                'name' => $player['name'],
                'image' => $player['image']
            ];
        }
    }
    
    return null;
}
?>